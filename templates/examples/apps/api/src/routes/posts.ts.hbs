import { Elysia, t } from "elysia";
import { authPlugin } from "@/middleware/auth";
import { postsHandler } from "@/handlers/posts";

export const postsRoutes = new Elysia({ prefix: "/posts" })
  .use(authPlugin)

  .get("/", async ({ profileId, query }) => {
    return postsHandler.list(profileId, query);
  }, {
    query: t.Object({
      page: t.Optional(t.Numeric({ minimum: 1 })),
      pageSize: t.Optional(t.Numeric({ minimum: 1, maximum: 100 })),
    }),
  })

  .get("/:id", async ({ profileId, params: { id } }) => {
    return postsHandler.getById(profileId, id);
  })

  .post("/", async ({ profileId, body }) => {
    return postsHandler.create(profileId, body);
  }, {
    body: t.Object({
      title: t.String({ minLength: 1 }),
      content: t.Optional(t.String()),
    }),
  })

  .patch("/:id", async ({ profileId, params: { id }, body }) => {
    return postsHandler.update(profileId, id, body);
  }, {
    body: t.Object({
      title: t.Optional(t.String({ minLength: 1 })),
      content: t.Optional(t.String()),
    }),
  })

  .delete("/:id", async ({ profileId, params: { id } }) => {
    return postsHandler.remove(profileId, id);
  });
